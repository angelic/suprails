#! /usr/bin/env ruby
#
# Suprails: The customizable wrapper to the rails command
#
# Copyright 2008 Bradley Grzesiak
# This file is part of Suprails.
# 
#     Suprails is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
# 
#     Suprails is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
# 
#     You should have received a copy of the GNU General Public License
#     along with Suprails.  If not, see <http://www.gnu.org/licenses/>.
#

require File.dirname(__FILE__) + '/../lib/suprails'
opts = ARGV
SUPRAILS_VERSION = 0.1

def is_setup?
  File.exists?(File.expand_path('~/.suprails'))
end

def setup_suprails
  nil
end

# Does the ~/.suprails folder exist?
if !is_setup?
  setup_suprails
  exit
end

if opts.length == 0
  puts 'You must provide a Rails Application Name'
else
  # If options include -v or --version, print the version and exit
  if opts.inject(false) {|memo, x| memo || %w{-v --version}.include?(x)}
    puts SUPRAILS_VERSION
    exit
  end
  
  # setup the config file, using ~/.suprails/config as default
  config = opts.index('-c') || opts.index('--config') || '~/.suprails/config'
  if config.is_a? Fixnum
    opts.delete_at(config)
    config = opts.delete_at(config)
  end
  
  if opts.first =~ /^[a-zA-Z0-9]+/
    Suprails.new.create_project
  else
    puts 'Invalid Application Name. Must start with alphanumeric character!'
  end
end
  
  

# suprails = Suprails.new
# execute_rails = false
# interactive_mode = false
# help_mode = false
# 
# if opts.length == 0
#   interactive_mode = true
# else
#   if ['-h', '--help'].include?(opts[0])
#     help_mode = true
#   else
#     suprails = Suprails.new opts.shift
#     execute_rails = true
#   end
# end
# 
# puts
# puts 'Behold, this is Suprails'
# 
# if execute_rails
#   suprails.create_project
# elsif interactive_mode
#   #TODO: write interactive mode
#   puts 'interactive mode not yet implemented, quitting'
# elsif help_mode
#   #TODO: write help screen
#   puts 'no help'
# end